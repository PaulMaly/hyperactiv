!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("wretch"),require("normaliz")):"function"==typeof define&&define.amd?define(["exports","wretch","normaliz"],t):t((e=e||self)["hyperactiv-http"]={},e.wretch,e.normaliz)}(this,function(e,t,r){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t;const n="__requests__",o=(e,t)=>`${e}@${t}`,c=e=>e,u={read(e,t){const r={};return Object.entries(e).forEach(([e,n])=>{r[e]={},n.forEach(n=>{r[e][n]=t[e]&&t[e][n]||null})}),r},write(e,t){Object.entries(e).forEach(([e,r])=>{t[e]||(t[e]={}),Object.entries(r).forEach(([r,n])=>{t[e][r]&&"object"==typeof t[e][r]&&"object"==typeof n?Object.entries(n).forEach(([n,o])=>{t[e][r][n]=o}):t[e][r]=n})})}};function i(e,{store:i,normalize:s,client:l=t(),beforeRequest:f=c,afterRequest:a=c,rootKey:y=n,serialize:h=o,bodyType:d="json",policy:p="cache-first"}){const b=f(l.url(e)),j=h("get",b._url);i[y]||(i[y]={});const q=i[y][j],z="network-only"!==p&&q&&u.read(q,i)||null;function m(){return b.get()[d](e=>a(e)).then(e=>{const t=r.normaliz(e,s);return i[y][j]=Object.entries(t).reduce((e,[t,r])=>(e[t]=Object.keys(r),e),{}),u.write(t,i),u.read(i[y][j],i)})}const w="cache-first"===p&&z?null:m();return{data:z,refetch:m,future:w}}function s(e,t,r){return e?null!==r?e[t]&&e[t][r]:e[t]&&Object.values(e[t]):e}e.normalized=i,e.request=function(e,{store:r,client:u=t(),beforeRequest:i=c,afterRequest:s=c,rootKey:l=n,serialize:f=o,bodyType:a="json",policy:y="cache-first"}){const h=i(u.url(e)),d=f("get",h._url);r[l]||(r[l]={});const p=r[l][d],b="network-only"!==y&&p||null;function j(){return h.get()[a](e=>s(e)).then(e=>(r[l][d]=e,e))}const q="cache-first"===y&&b?null:j();return{data:b,refetch:j,future:q}},e.resource=function(e,t,{id:r=null,store:n,normalize:o,client:c,beforeRequest:u,afterRequest:l,serialize:f,rootKey:a,bodyType:y,policy:h="cache-first"}){const d=r&&n[e]&&n[e][r],{data:p,future:b,refetch:j}=i(t,{store:n,normalize:{schema:[],...o,entity:e},client:c,beforeRequest:u,afterRequest:l,serialize:f,rootKey:a,bodyType:y,policy:h});return{data:"network-only"!==h&&d||s(p,e,r),future:b&&b.then(t=>s(t,e,r))||null,refetch:()=>j().then(t=>s(t,e,r))}},Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=index.js.map
