!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.hyperactiv=t()}(this,function(){"use strict";const e=[],t=new WeakMap,n={timeout:null,queue:new Set,process:()=>{for(let e of n.queue)e();n.queue.clear(),n.timeout=null},enqueue:e=>{null===n.timeout&&(n.timeout=setTimeout(n.process,0)),n.queue.add(e)}},o=function(u,s={}){const{props:i=null,ignore:r=null,batch:c=!1,deep:f=!1}=s;if(t.set(u,new Map),f)if(u instanceof Array)for(const e in u)"object"==typeof u[e]&&(u[e]=o(u[e],s));else for(let e in u){if(!u.hasOwnProperty(e))continue;const t=u[e];"object"==typeof t&&(u[e]=o(t,s))}return new Proxy(u,{get(n,o){const s=t.get(u);if(i&&!i.includes(o)||r&&r.includes(o))return u[o];s.has(o)||s.set(o,new Set);const c=s.get(o);return e.length>0&&c.add(e[0]),s.set(o,c),u[o]},set(e,l,p){const d=t.get(u);if(u[l]===p)return!0;if(u[l]=!f||l in u||"object"!=typeof p?p:o(p,s),i&&!i.includes(l)||r&&r.includes(l))return!0;if(d.has(l)){const e=d.get(l);for(let t of e)t.__disposed?e.delete(t):c?n.enqueue(t):t()}return!0}})};return{observe:o,computed:function(t,{autoRun:n=!0,callback:o=null}={}){const u=new Proxy(t,{apply:function(t,n,s){const i=(i=null)=>{e.unshift(o||u);const r=i?i():t.apply(n,s);return e.shift(),r};return s.push({computeAsync:e=>i(e)}),i()}});return n&&u(),u},dispose:e=>e.__disposed=!0}});
