!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.hyperactiv=t()}(this,function(){"use strict";const e=[],t=new WeakMap,n=e=>"object"==typeof e,u={timeout:null,queue:new Set,process(){for(let e of u.queue)e();u.queue.clear(),u.timeout=null},enqueue(e){null===u.timeout&&(u.timeout=setTimeout(u.process,0)),u.queue.add(e)}},o=function(s,c={}){const{props:i=null,ignore:r=null,batch:l=!1,deep:d=!1}=c;return t.set(s,new Map),d&&Object.entries(s).forEach(([e,t])=>{n(t)&&(s[e]=o(t,c))}),new Proxy(s,{get(n,u){if((!i||i.includes(u))&&(!r||!r.includes(u))){const n=t.get(s);n.has(u)||n.set(u,new Set),e.length&&n.get(u).add(e[0])}return s[u]},set(p,f,a){const h=t.get(s);if(s[f]===a)return!0;if(s[f]=!d||f in s||!n(a)?a:o(a,c),(!i||i.includes(f))&&(!r||!r.includes(f))&&h.has(f)){const t=h.get(f);for(let n of t)n.__disposed?t.delete(n):n!==e[0]&&(l?u.enqueue(n):n())}return!0}})};return{observe:o,computed:function(t,{autoRun:n=!0,callback:u=null}={}){const o=new Proxy(t,{apply(t,n,s){const c=(c=null)=>{e.unshift(u||o);const i=c?c():t.apply(n,s);return e.shift(),i};return s.push({computeAsync:e=>c(e)}),c()}});return n&&o(),o},dispose:e=>e.__disposed=!0}});
