!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.hyperactiv=t()}(this,function(){"use strict";const e=[],t=new WeakMap,n=e=>e&&"object"==typeof e,u=Array.isArray,o={timeout:null,queue:new Set,process(){for(const e of o.queue)e();o.queue.clear(),o.timeout=null},enqueue(e){null===o.timeout&&(o.timeout=setTimeout(o.process,0)),o.queue.add(e)}},s=function(r,c={}){const{props:i=null,ignore:l=null,batch:d=!1,deep:f=!1}=c;return r.__observed?r:(t.set(r,new Map),f&&Object.entries(r).forEach(([e,t])=>{n(t)&&(r[e]=s(t,c))}),new Proxy(r,{get(n,u){if("__observed"===u)return!0;if((!i||i.includes(u))&&(!l||!l.includes(u))&&e.length){const n=t.get(r);n.has(u)||n.set(u,new Set),n.get(u).add(e[0])}return r[u]},set(p,a,y){const h=t.get(r);if((!u(r)||"length"!==a)&&r[a]===y)return!0;if(r[a]=f&&n(y)?s(y,c):y,(!i||i.includes(a))&&(!l||!l.includes(a))&&h.has(a)){const t=h.get(a);for(const n of t)n.__disposed?t.delete(n):n!==e[0]&&(d?o.enqueue(n):n())}return!0}}))};return{observe:s,computed:function(t,{autoRun:n=!0,callback:u=null}={}){const o=new Proxy(t,{apply(t,n,s){const r=(r=null)=>{e.unshift(u||o);const c=r?r():t.apply(n,s);return e.shift(),c};return s.push({computeAsync:e=>r(e)}),r()}});return n&&o(),o},dispose:e=>e.__disposed=!0}});
