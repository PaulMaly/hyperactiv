!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):e.hyperactiv=n()}(this,function(){"use strict";const e=[],n=new WeakMap,t=function(e){return e&&"object"==typeof e},r=Array.isArray,u=function(e,n,t){Object.defineProperty(e,"__key",{value:n,enumerable:!1,configurable:!0}),Object.defineProperty(e,"__parent",{value:t,enumerable:!1,configurable:!0})},o={timeout:null,queue:new Set,process(){for(const e of o.queue)e();o.queue.clear(),o.timeout=null},enqueue(e){null===o.timeout&&(o.timeout=setTimeout(o.process,0)),o.queue.add(e)}},i=function(s,c={}){const{props:l=null,ignore:f=null,batch:a=!1,deep:d=!1,handler:p=null,bind:b=!1}=c;if(s.__observed)return s;n.set(s,new Map),d&&Object.entries(s).forEach(function([e,n]){t(n)&&(s[e]=i(n,c),p&&u(s[e],e,s))});const y=new Proxy(s,{get(t,r){if("__observed"===r)return!0;if((!l||l.includes(r))&&(!f||!f.includes(r))&&e.length){const t=n.get(s);t.has(r)||t.set(r,new Set),t.get(r).add(e[0])}return s[r]},set(b,_,g){const h=n.get(s);if((!r(s)||"length"!==_)&&s[_]===g)return!0;if(s[_]=d&&t(g)?i(g,c):g,p&&d&&t(g)&&u(s[_],_,s),p){const e=[_];let n=s;for(;n.__key&&n.__parent;)e.unshift(n.__key),n=n.__parent;p(e,g,y)}if((!l||l.includes(_))&&(!f||!f.includes(_))&&h.has(_)){const n=h.get(_);for(const t of n)t.__disposed?n.delete(t):t!==e[0]&&(a?o.enqueue(t):t())}return!0},deleteProperty:(e,n)=>(e[n]&&p&&(delete e[n].__key,delete e[n].__parent),delete e[n],!0)});return b&&t(s)&&Object.getOwnPropertyNames(s).forEach(e=>{"function"==typeof s[e]&&(s[e]=s[e].bind(y))}),y};return{observe:i,computed:function(n,{autoRun:t=!0,callback:r=null,bind:u=null}={}){const o=new Proxy(n,{apply(n,t,i){const s=function(s=null){e.unshift(r||o);const c=s?s():n.apply(u||t,i);return e.shift(),c};return i.push({computeAsync:function(e){return s(e)}}),s()}});return t&&o(),o},dispose:function(e){return e.__disposed=!0},handlers:{write:function(e){if(!e)throw new Error("writeHandler needs a proper target !");return function(n,t){t=JSON.parse(JSON.stringify(t));for(let t=0;t<n.length-1;t++){const u=n[t],o=n[t+1];void 0===e[u]&&(e[u]=(r=o,Number.isInteger(Number.parseInt(r))?[]:{})),e=e[u]}var r;e[n[n.length-1]]=t}},debug:function(e){return e=e||console,function(n,t){const r=n.map(e=>Number.isInteger(Number.parseInt(e))?`[${e}]`:`.${e}`).join("").substr(1);e.debug(`${r} = ${JSON.stringify(t,null,"\t")}`)}},all:function(e){return Array.isArray(e)?(n,t,r)=>e.forEach(e=>e(n,t,r)):e}}}});
